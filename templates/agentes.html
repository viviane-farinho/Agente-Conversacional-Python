{% extends "base.html" %}

{% block title %}Multiagente - Secretaria IA{% endblock %}

{% block extra_css %}
<style>
    /* Scoped styles for this page only to match the "Neon Glass" look */
    :root {
        --neon-purple: #d946ef;
        --neon-green: #22c55e;
        --neon-blue: #3b82f6;
        --neon-cyan: #06b6d4;
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-highlight: rgba(255, 255, 255, 0.15);
    }



    /* Deep Space Background with Nebula Effects */
    .agents-dashboard {
        background-color: #020204;
        background-image:
            radial-gradient(circle at 20% 30%, rgba(217, 70, 239, 0.4) 0%, transparent 60%),
            radial-gradient(circle at 80% 20%, rgba(34, 197, 94, 0.3) 0%, transparent 60%),
            radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.4) 0%, transparent 60%),
            radial-gradient(circle at 20% 80%, rgba(6, 182, 212, 0.3) 0%, transparent 60%);
        color: #ffffff;
        padding: 2rem;
        border-radius: 24px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        position: relative;
        overflow: hidden;
    }

    /* Premium Glass Card - Base Style */
    .glass-card {
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        border-radius: 28px;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-top: 1px solid rgba(255, 255, 255, 0.4);
        /* Top light effect */
        border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    }

    /* Supervisor Card - Purple Nebula Theme */
    .card-supervisor {
        background: linear-gradient(180deg, rgba(217, 70, 239, 0.15) 0%, rgba(10, 10, 15, 0.8) 100%);
        box-shadow: 0 0 40px rgba(217, 70, 239, 0.1), inset 0 0 20px rgba(217, 70, 239, 0.05);
    }

    .card-supervisor:hover {
        border-color: rgba(217, 70, 239, 0.6);
        border-top-color: rgba(217, 70, 239, 0.8);
        box-shadow: 0 0 60px rgba(217, 70, 239, 0.25), inset 0 0 30px rgba(217, 70, 239, 0.1);
        transform: translateY(-2px);
    }

    /* Glowing Brain Orb Effect */
    .card-supervisor .icon-box {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, rgba(217, 70, 239, 0.8) 20%, rgba(217, 70, 239, 0.2) 60%, transparent 100%);
        border: 1px solid rgba(217, 70, 239, 0.4);
        box-shadow:
            0 0 30px rgba(217, 70, 239, 0.6),
            inset 0 0 20px rgba(217, 70, 239, 0.4);
        position: relative;
        overflow: hidden;
    }

    .card-supervisor .icon-box::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
        animation: pulse-glow 3s infinite ease-in-out;
    }

    @keyframes pulse-glow {
        0% {
            transform: scale(0.8);
            opacity: 0.5;
        }

        50% {
            transform: scale(1.1);
            opacity: 0.8;
        }

        100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
    }

    /* Vendas Card - Green Theme */
    .card-vendas {
        background: linear-gradient(180deg, rgba(34, 197, 94, 0.15) 0%, rgba(10, 10, 15, 0.8) 100%);
        box-shadow: 0 0 30px rgba(34, 197, 94, 0.1);
    }

    .card-vendas:hover {
        border-color: rgba(34, 197, 94, 0.6);
        border-top-color: rgba(34, 197, 94, 0.8);
        box-shadow: 0 0 50px rgba(34, 197, 94, 0.25);
        transform: translateY(-2px);
    }

    .card-vendas .icon-box {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, rgba(34, 197, 94, 0.6) 30%, rgba(34, 197, 94, 0.1) 70%);
        border: 1px solid rgba(34, 197, 94, 0.5);
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        position: relative;
        overflow: hidden;
    }

    .card-vendas .icon-box::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
        animation: pulse-glow 3s infinite ease-in-out;
        animation-delay: 0.5s;
    }

    /* Suporte Card - Blue Theme */
    .card-suporte {
        background: linear-gradient(180deg, rgba(59, 130, 246, 0.15) 0%, rgba(10, 10, 15, 0.8) 100%);
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.1);
    }

    .card-suporte:hover {
        border-color: rgba(59, 130, 246, 0.6);
        border-top-color: rgba(59, 130, 246, 0.8);
        box-shadow: 0 0 50px rgba(59, 130, 246, 0.25);
        transform: translateY(-2px);
    }

    .card-suporte .icon-box {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, rgba(59, 130, 246, 0.6) 30%, rgba(59, 130, 246, 0.1) 70%);
        border: 1px solid rgba(59, 130, 246, 0.5);
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        position: relative;
        overflow: hidden;
    }

    .card-suporte .icon-box::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
        animation: pulse-glow 3s infinite ease-in-out;
        animation-delay: 1s;
    }

    /* Agendamento Card - Cyan Theme */
    .card-agendamento {
        background: linear-gradient(180deg, rgba(6, 182, 212, 0.15) 0%, rgba(10, 10, 15, 0.8) 100%);
        box-shadow: 0 0 30px rgba(6, 182, 212, 0.1);
    }

    .card-agendamento:hover {
        border-color: rgba(6, 182, 212, 0.6);
        border-top-color: rgba(6, 182, 212, 0.8);
        box-shadow: 0 0 50px rgba(6, 182, 212, 0.25);
        transform: translateY(-2px);
    }

    .card-agendamento .icon-box {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, rgba(6, 182, 212, 0.6) 30%, rgba(6, 182, 212, 0.1) 70%);
        border: 1px solid rgba(6, 182, 212, 0.5);
        box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        position: relative;
        overflow: hidden;
    }

    .card-agendamento .icon-box::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
        animation: pulse-glow 3s infinite ease-in-out;
        animation-delay: 1.5s;
    }

    /* Knowledge Base Card - Indigo Theme */
    .card-knowledge {
        background: linear-gradient(180deg, rgba(79, 70, 229, 0.15) 0%, rgba(10, 10, 15, 0.8) 100%);
        box-shadow: 0 0 30px rgba(79, 70, 229, 0.1);
    }

    .card-knowledge:hover {
        border-color: rgba(79, 70, 229, 0.6);
        border-top-color: rgba(79, 70, 229, 0.8);
        box-shadow: 0 0 50px rgba(79, 70, 229, 0.25);
        transform: translateY(-2px);
    }

    .card-knowledge .icon-box {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, rgba(79, 70, 229, 0.6) 30%, rgba(79, 70, 229, 0.1) 70%);
        border: 1px solid rgba(79, 70, 229, 0.5);
        box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        position: relative;
        overflow: hidden;
    }

    .card-knowledge .icon-box::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
        animation: pulse-glow 3s infinite ease-in-out;
        animation-delay: 2s;
    }

    /* Add New Agent Card */
    .card-new {
        background: rgba(255, 255, 255, 0.03);
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 28px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .card-new:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 40px rgba(255, 255, 255, 0.15);
        transform: translateY(-4px);
    }

    .card-new .icon-box {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    /* UI Elements */
    .status-badge {
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(4px);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        box-shadow: 0 0 8px currentColor;
    }

    .btn-glass {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.25);
        color: white;
        border-radius: 14px;
        padding: 10px 24px;
        font-weight: 600;
        transition: all 0.2s;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }

    .btn-glass:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);
    }

    /* Text Gradients */
    .text-gradient-purple {
        background: linear-gradient(to right, #fff, #d946ef);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>
{% endblock %}

{% block content %}
<div class="agents-dashboard py-4 px-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="fw-bold mb-1 text-white fs-4">Multiagente</h2>
            <p class="text-white-50 mb-0 small">Gerencie sua equipe de inteligência artificial</p>
        </div>
    </div>

    <!-- Top Row: Supervisor + Vendas -->
    <div class="row g-3 mb-3">
        <!-- Supervisor Section (Wider) -->
        <div class="col-md-8">
            <div class="glass-card card-supervisor h-100 p-3 d-flex flex-column justify-content-center">
                <div class="row align-items-center">
                    <div class="col-md-7 d-flex gap-3 align-items-center">
                        <div class="d-flex flex-column align-items-center gap-2">
                            <!-- Glowing Brain Orb Container -->
                            <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                                style="width: 90px; height: 90px;">
                                <!-- Fallback to CPU/Brain icon if image fails -->
                                <i class="bi bi-cpu text-white"
                                    style="font-size: 2.8rem; filter: drop-shadow(0 0 15px #bd34fe); z-index: 2;"></i>

                                <!-- Neural Network CSS Effect -->
                                <div class="position-absolute w-100 h-100 rounded-circle"
                                    style="background: radial-gradient(circle at 30% 30%, rgba(217, 70, 239, 0.4), transparent 70%); z-index: 1;">
                                </div>
                            </div>
                            <span class="status-badge text-white" style="padding: 4px 8px; font-size: 0.75rem;">
                                <span class="status-dot" style="color: #30d158; width: 6px; height: 6px;"></span>Online
                            </span>
                        </div>
                        <div>
                            <h3 class="fw-bold mb-1 text-white fs-4">Supervisor (Cérebro)</h3>
                            <p class="text-white-50 mb-2 small" style="line-height: 1.4;">
                                Orquestra o atendimento e decide qual especialista chamar com base na intenção do
                                cliente.
                            </p>
                            <div class="d-flex gap-3">
                                <div class="d-flex align-items-center gap-2 text-white-50 small">
                                    <i class="bi bi-shuffle" style="color: #bd34fe;"></i>
                                    <span class="fw-medium text-white">1.2k</span> roteamentos
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5 d-flex justify-content-end align-items-center gap-2 mt-3 mt-md-0">
                        <button class="btn btn-glass btn-sm" onclick="configurarSupervisor()">
                            <i class="bi bi-gear me-2"></i>Configurar
                        </button>
                        <button class="btn btn-glass btn-sm" onclick="verLogs()">
                            <i class="bi bi-journal-text me-2"></i>Logs
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vendas (Side) -->
        <!-- Knowledge Base (Swapped to Top) -->
        <div class="col-md-4">
            <div class="card-new card-knowledge h-100 p-3 d-flex flex-column align-items-center justify-content-center"
                onclick="abrirModalKnowledgeBase()" style="cursor: pointer;">
                <div class="icon-box rounded-circle d-flex align-items-center justify-content-center mb-2"
                    style="width: 56px; height: 56px;">
                    <i class="bi bi-database-fill-gear text-white"
                        style="font-size: 1.6rem; filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));"></i>
                </div>
                <h5 class="fw-bold mb-0 text-white fs-5">Base de Conhecimento</h5>
                <p class="text-white-50 small mb-0 text-center" style="font-size: 0.85rem;">Gerenciar documentos e RAG
                </p>
            </div>
        </div>
    </div>

    <!-- Bottom Row: Suporte, Agendamento, Novo -->
    <div class="row g-3">
        <!-- Suporte -->
        <div class="col-md-4">
            <div class="glass-card card-suporte h-100 p-3 d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="position-relative">
                        <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 56px; height: 56px;">
                            <i class="bi bi-tools text-white"
                                style="font-size: 1.4rem; filter: drop-shadow(0 0 10px #3b82f6); z-index: 2;"></i>
                            <div class="position-absolute w-100 h-100 rounded-circle"
                                style="background: radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.4), transparent 70%); z-index: 1;">
                            </div>
                        </div>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked onchange="toggleAgente('suporte')"
                            style="background-color: #3b82f6; border-color: #3b82f6;">
                    </div>
                </div>

                <h4 class="fw-bold mb-1 text-white fs-5">Suporte</h4>
                <div class="mb-2">
                    <span class="status-badge text-white-50" style="padding: 4px 8px; font-size: 0.75rem;">
                        <span class="status-dot" style="color: #3b82f6; width: 6px; height: 6px;"></span>Online
                    </span>
                </div>
                <p class="text-white-50 small mb-3 flex-grow-1" style="font-size: 0.85rem;">Tira dúvidas técnicas e
                    resolve problemas.</p>

                <div class="d-flex align-items-end justify-content-between">
                    <div>
                        <h3 class="fw-bold mb-0 text-white fs-4">4.8</h3>
                        <span class="text-white-50 small" style="font-size: 0.75rem;">satisfação</span>
                    </div>
                    <button class="btn btn-glass btn-sm" onclick="configurarAgente('suporte')">Configurar</button>
                </div>
            </div>
        </div>

        <!-- Agendamento -->
        <div class="col-md-4">
            <div class="glass-card card-agendamento h-100 p-3 d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="position-relative">
                        <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 56px; height: 56px;">
                            <i class="bi bi-calendar-check text-white"
                                style="font-size: 1.4rem; filter: drop-shadow(0 0 10px #06b6d4); z-index: 2;"></i>
                            <div class="position-absolute w-100 h-100 rounded-circle"
                                style="background: radial-gradient(circle at 30% 30%, rgba(6, 182, 212, 0.4), transparent 70%); z-index: 1;">
                            </div>
                        </div>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked onchange="toggleAgente('agendamento')"
                            style="background-color: #06b6d4; border-color: #06b6d4;">
                    </div>
                </div>

                <h4 class="fw-bold mb-1 text-white fs-5">Agendamento</h4>
                <div class="mb-2">
                    <span class="status-badge text-white-50" style="padding: 4px 8px; font-size: 0.75rem;">
                        <span class="status-dot" style="color: #06b6d4; width: 6px; height: 6px;"></span>Online
                    </span>
                </div>
                <p class="text-white-50 small mb-3 flex-grow-1" style="font-size: 0.85rem;">Gerencia marcação de
                    consultas.</p>

                <div class="d-flex align-items-end justify-content-between">
                    <div>
                        <h3 class="fw-bold mb-0 text-white fs-4">12</h3>
                        <span class="text-white-50 small" style="font-size: 0.75rem;">hoje</span>
                    </div>
                    <button class="btn btn-glass btn-sm" onclick="configurarAgente('agendamento')">Configurar</button>
                </div>
            </div>
        </div>

        <!-- Knowledge Base -->
        <!-- Vendas (Swapped to Bottom) -->
        <div class="col-md-4">
            <div class="glass-card card-vendas h-100 p-3 d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="position-relative">
                        <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 56px; height: 56px;">
                            <i class="bi bi-currency-exchange text-white"
                                style="font-size: 1.6rem; filter: drop-shadow(0 0 10px #22c55e); z-index: 2;"></i>
                            <div class="position-absolute w-100 h-100 rounded-circle"
                                style="background: radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.4), transparent 70%); z-index: 1;">
                            </div>
                        </div>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked onchange="toggleAgente('vendas')"
                            style="background-color: #22c55e; border-color: #22c55e;">
                    </div>
                </div>

                <h4 class="fw-bold mb-1 text-white fs-5">Vendas</h4>
                <div class="mb-2">
                    <span class="status-badge text-white-50" style="padding: 4px 8px; font-size: 0.75rem;">
                        <span class="status-dot" style="color: #22c55e; width: 6px; height: 6px;"></span>Online
                    </span>
                </div>
                <p class="text-white-50 small mb-3 flex-grow-1" style="font-size: 0.85rem;">Especialista em conversão e
                    ofertas.</p>

                <div class="d-flex align-items-end justify-content-between">
                    <div>
                        <h3 class="fw-bold mb-0 text-white fs-4">15%</h3>
                        <span class="text-white-50 small" style="font-size: 0.75rem;">conversão</span>
                    </div>
                    <button class="btn btn-glass btn-sm" onclick="configurarAgente('vendas')">Configurar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Profissionais Section (Separate Container) -->
<div class="agents-dashboard py-4 px-4 mt-4">
    <div class="profissionais-section">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 48px; height: 48px; background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3);">
                        <i class="bi bi-people-fill text-white"
                            style="font-size: 1.5rem; filter: drop-shadow(0 0 10px #06b6d4);"></i>
                    </div>
                    <div>
                        <h3 class="fw-bold mb-0 text-white">Meus Profissionais</h3>
                        <p class="text-white-50 mb-0 small">Profissionais disponíveis para agendamento</p>
                    </div>
                </div>
                <button class="btn btn-glass btn-sm" onclick="abrirModalNovoProfissional()">
                    <i class="bi bi-plus-lg me-1"></i> Novo Profissional
                </button>
            </div>

            <!-- Lista de Profissionais -->
            <div id="listaProfissionaisCards" class="row g-3">
                <div class="col-12 text-center text-white-50 py-4">
                    <i class="bi bi-hourglass-split"></i> Carregando profissionais...
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Novo/Editar Profissional -->
<div class="modal fade" id="modalProfissionalMulti" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="background: #1a1a1a; border: 1px solid #333; color: white;">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title fw-bold" id="modalProfMultiTitle">Novo Profissional</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formProfissionalMulti">
                    <input type="hidden" id="profMultiId">
                    <div class="mb-3">
                        <label class="form-label text-white-50">Nome Completo *</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="profMultiNome"
                            required placeholder="Ex: Rafael Oliveira">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Cargo</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="profMultiCargo"
                            placeholder="Ex: Mentor, Consultor, Especialista">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Especialidade</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary"
                            id="profMultiEspecialidade" placeholder="Ex: Marketing Digital, Vendas, Finanças">
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top border-secondary">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger d-none" id="btnDesativarMulti"
                    onclick="desativarProfissionalMulti()">
                    <i class="bi bi-x-circle me-1"></i> Desativar
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarProfissionalMulti()">
                    <i class="bi bi-save me-1"></i> Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Knowledge Base (List) -->
<div class="modal fade" id="modalKnowledgeBase" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content"
            style="background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 40px rgba(0,0,0,0.5); color: white;">
            <div class="modal-header border-bottom border-secondary">
                <div>
                    <h5 class="modal-title fw-bold">Base de Conhecimento</h5>
                    <p class="text-white-50 mb-0 small">Gerencie os documentos que sua IA usa para responder.</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-glass btn-sm" onclick="novoDocumentoKB()">
                        <i class="bi bi-plus-lg me-1"></i> Novo Documento
                    </button>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
            </div>
            <div class="modal-body p-0">
                <!-- Loading State -->
                <div id="kbLoading" class="text-center py-5">
                    <div class="spinner-border text-primary mb-2" role="status"></div>
                    <p class="text-white-50 mb-0">Carregando documentos...</p>
                </div>

                <!-- Empty State -->
                <div id="kbEmpty" class="text-center py-5 d-none">
                    <i class="bi bi-folder2-open display-4 text-white-50 mb-3"></i>
                    <p class="text-white-50 mb-3">Nenhum documento encontrado.</p>
                    <button class="btn btn-primary btn-sm" onclick="novoDocumentoKB()">
                        Criar Primeiro Documento
                    </button>
                </div>

                <!-- Document List -->
                <div id="kbList" class="list-group list-group-flush d-none">
                    <!-- Items will be injected here via JS -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Document Editor -->
<div class="modal fade" id="modalDocumentoEditor" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content"
            style="background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 40px rgba(0,0,0,0.5); color: white;">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title fw-bold" id="modalDocTitle">Novo Documento</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formDocumentoKB">
                    <input type="hidden" id="docId">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label class="form-label text-white-50">Título *</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary" id="docTitulo"
                                required placeholder="Ex: Política de Trocas">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label text-white-50">Categoria *</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary"
                                id="docCategoria" required placeholder="Ex: institucional">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Conteúdo *</label>
                        <textarea class="form-control bg-dark text-white border-secondary" id="docConteudo" rows="10"
                            required placeholder="Digite o conteúdo que a IA deve aprender..."></textarea>
                        <small class="text-white-50">Este conteúdo será indexado para busca semântica.</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top border-secondary">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger d-none" id="btnExcluirDoc" onclick="excluirDocumentoKB()">
                    <i class="bi bi-trash me-1"></i> Excluir
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarDocumentoKB()">
                    <i class="bi bi-save me-1"></i> Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Calendar Section (Separate Container) -->
<div class="agents-dashboard py-4 px-4 mt-4">
    <div class="calendar-section">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-box rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 48px; height: 48px; background: rgba(217, 70, 239, 0.1); border: 1px solid rgba(217, 70, 239, 0.3);">
                        <i class="bi bi-calendar-event text-white"
                            style="font-size: 1.5rem; filter: drop-shadow(0 0 10px #bd34fe);"></i>
                    </div>
                    <div>
                        <h3 class="fw-bold mb-0 text-white">Agenda Inteligente</h3>
                        <p class="text-white-50 mb-0 small">Próximos agendamentos e tarefas</p>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-glass btn-sm"><i class="bi bi-chevron-left"></i></button>
                    <button class="btn btn-glass btn-sm"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar-grid">
                <!-- Weekdays -->
                <div class="d-grid"
                    style="grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; margin-bottom: 15px;">
                    <div class="text-white-50 small fw-bold">DOM</div>
                    <div class="text-white-50 small fw-bold">SEG</div>
                    <div class="text-white-50 small fw-bold">TER</div>
                    <div class="text-white-50 small fw-bold">QUA</div>
                    <div class="text-white-50 small fw-bold">QUI</div>
                    <div class="text-white-50 small fw-bold">SEX</div>
                    <div class="text-white-50 small fw-bold">SAB</div>
                </div>

                <!-- Days -->
                <div class="d-grid" style="grid-template-columns: repeat(7, 1fr); gap: 10px;">
                    <!-- Previous Month -->
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">29</div>
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">30</div>

                    <!-- Current Month -->
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">1</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">2</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        3
                        <div class="position-absolute bottom-0 start-50 translate-middle-x mb-2 d-flex gap-1">
                            <div class="rounded-circle"
                                style="width: 4px; height: 4px; background: #22c55e; box-shadow: 0 0 5px #22c55e;">
                            </div>
                        </div>
                    </div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative active-day"
                        style="background: linear-gradient(135deg, rgba(217, 70, 239, 0.2), rgba(217, 70, 239, 0.05)); border: 1px solid rgba(217, 70, 239, 0.5); box-shadow: 0 0 15px rgba(217, 70, 239, 0.2);">
                        4
                        <div class="position-absolute top-0 end-0 mt-1 me-2 text-white-50" style="font-size: 0.6rem;">
                            HOJE
                        </div>
                        <div class="mt-2">
                            <div class="p-1 rounded mb-1 text-truncate"
                                style="background: rgba(34, 197, 94, 0.2); font-size: 0.7rem; border-left: 2px solid #22c55e;">
                                <span class="text-white">R$ 5.000</span>
                            </div>
                            <div class="p-1 rounded text-truncate"
                                style="background: rgba(6, 182, 212, 0.2); font-size: 0.7rem; border-left: 2px solid #06b6d4;">
                                <span class="text-white">Consulta Dr. Silva</span>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">5</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">6</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">7</div>

                    <!-- Row 2 -->
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">8</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        9
                        <div class="position-absolute bottom-0 start-50 translate-middle-x mb-2 d-flex gap-1">
                            <div class="rounded-circle"
                                style="width: 4px; height: 4px; background: #3b82f6; box-shadow: 0 0 5px #3b82f6;">
                            </div>
                        </div>
                    </div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">10</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">11</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">12</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">13</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">14</div>

                    <!-- Row 3 -->
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">15</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">16</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">17</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        18
                        <div class="mt-2">
                            <div class="p-1 rounded text-truncate"
                                style="background: rgba(6, 182, 212, 0.2); font-size: 0.7rem; border-left: 2px solid #06b6d4;">
                                <span class="text-white">Reunião Equipe</span>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">19</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">20</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">21</div>

                    <!-- Row 4 -->
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">22</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">23</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">24</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        25
                        <div class="mt-2">
                            <div class="p-1 rounded mb-1 text-truncate"
                                style="background: rgba(34, 197, 94, 0.2); font-size: 0.7rem; border-left: 2px solid #22c55e;">
                                <span class="text-white">R$ 12.500</span>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">26</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">27</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">28</div>

                    <!-- Row 5 -->
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">29</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">30</div>
                    <div class="calendar-day p-3 rounded-3 text-white position-relative"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">31</div>

                    <!-- Next Month Preview -->
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">1</div>
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">2</div>
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">3</div>
                    <div class="calendar-day disabled p-3 rounded-3 text-white-50"
                        style="background: rgba(255,255,255,0.02);">4</div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .calendar-day {
            min-height: 100px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .calendar-day:not(.disabled):hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3) !important;
        }
    </style>

    <!-- Modal Configuração de Agente -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background: #1a1a1a; border: 1px solid #333; color: white;">
                <div class="modal-header border-bottom border-secondary">
                    <h5 class="modal-title fw-bold" id="modalTitle">Configurar Agente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formAgente">
                        <input type="hidden" id="agenteId">
                        <input type="hidden" id="agenteTipo">

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label text-white-50">Nome do Agente *</label>
                                <input type="text" class="form-control bg-dark text-white border-secondary"
                                    id="agenteNome" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-white-50">Status</label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="agenteAtivo" checked>
                                    <label class="form-check-label text-white" for="agenteAtivo">Agente Ativo</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-white-50">Descricao</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary"
                                id="agenteDescricao" placeholder="Breve descricao do proposito deste agente">
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-white-50">Prompt do Sistema *</label>
                            <textarea class="form-control bg-dark text-white border-secondary" id="agentePrompt"
                                rows="10" style="font-family: monospace; font-size: 13px;"
                                placeholder="Instrucoes para o agente..."></textarea>
                            <small class="text-white-50">
                                Variaveis disponiveis: {phone}, {conversation_id}, {current_date}, {empresa_text},
                                {professionals_text}
                            </small>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label text-white-50">Tools Disponiveis</label>
                                <select class="form-select bg-dark text-white border-secondary" id="agenteTools"
                                    multiple size="4">
                                    <option value="verificar_disponibilidade">verificar_disponibilidade</option>
                                    <option value="criar_agendamento">criar_agendamento</option>
                                    <option value="cancelar_agendamento">cancelar_agendamento</option>
                                    <option value="buscar_rag">buscar_rag</option>
                                    <option value="transferir_humano">transferir_humano</option>
                                </select>
                                <small class="text-white-50">Ctrl+Click para selecionar multiplas</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-white-50">Categorias RAG</label>
                                <select class="form-select bg-dark text-white border-secondary" id="agenteCategoriasRag"
                                    multiple size="4">
                                    <option value="geral">geral</option>
                                    <option value="servicos">servicos</option>
                                    <option value="precos">precos</option>
                                    <option value="promocoes">promocoes</option>
                                    <option value="faq">faq</option>
                                    <option value="procedimentos">procedimentos</option>
                                    <option value="politicas">politicas</option>
                                    <option value="profissionais">profissionais</option>
                                    <option value="horarios">horarios</option>
                                </select>
                                <small class="text-white-50">Categorias da base de conhecimento</small>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-top border-secondary">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarAgente()">
                        <i class="bi bi-save me-1"></i> Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sales Pipeline Section (Separate Container) -->
<div class="agents-dashboard py-4 px-4 mt-4 d-flex flex-column">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h3 class="fw-bold mb-1 text-white fs-5">Pipeline de Vendas</h3>
            <p class="text-white-50 mb-0 small">Acompanhe suas oportunidades em tempo real</p>
        </div>
        <button class="btn btn-glass btn-sm">
            <i class="bi bi-arrow-right me-1"></i> Ver Tudo
        </button>
    </div>

    <div class="glass-card p-4 flex-grow-1 d-flex flex-column">
        <div class="row g-3 flex-grow-1">
            <!-- Column: Leads -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-funnel text-primary me-2"></i>Leads
                        </h6>
                        <span class="badge bg-primary bg-opacity-25 text-primary">12</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3 mb-2"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-white-50">Há 2h</small>
                            <i class="bi bi-whatsapp text-success"></i>
                        </div>
                        <h6 class="text-white mb-1">Carlos Eduardo</h6>
                        <p class="text-white-50 small mb-0">Interesse no plano anual...</p>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-white-50">Há 5h</small>
                            <i class="bi bi-instagram text-danger"></i>
                        </div>
                        <h6 class="text-white mb-1">Ana Julia</h6>
                        <p class="text-white-50 small mb-0">Dúvida sobre preços...</p>
                    </div>
                </div>
            </div>

            <!-- Column: Em Negociação -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-chat-dots text-warning me-2"></i>Em Negociação
                        </h6>
                        <span class="badge bg-warning bg-opacity-25 text-warning">5</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3 mb-2"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-warning text-dark" style="font-size: 0.65rem;">Quente 🔥</span>
                            <small class="text-white-50">R$ 1.200</small>
                        </div>
                        <h6 class="text-white mb-1">Empresa XYZ Ltda</h6>
                        <p class="text-white-50 small mb-0">Aguardando aprovação...</p>
                    </div>
                </div>
            </div>

            <!-- Column: Fechado -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-check-circle text-success me-2"></i>Fechado
                        </h6>
                        <span class="badge bg-success bg-opacity-25 text-success">28</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); opacity: 0.7;">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-success" style="font-size: 0.65rem;">Pago</span>
                            <small class="text-white-50">Ontem</small>
                        </div>
                        <h6 class="text-white mb-1">Roberto Silva</h6>
                        <p class="text-white-50 small mb-0">Plano Premium Anual</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Support Pipeline Section (Separate Container) -->
<div class="agents-dashboard py-4 px-4 mt-4 d-flex flex-column">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h3 class="fw-bold mb-1 text-white fs-5">Pipeline de Suporte</h3>
            <p class="text-white-50 mb-0 small">Gerencie tickets e solicitações de ajuda</p>
        </div>
        <button class="btn btn-glass btn-sm">
            <i class="bi bi-arrow-right me-1"></i> Ver Tudo
        </button>
    </div>

    <div class="glass-card p-4 flex-grow-1 d-flex flex-column">
        <div class="row g-3 flex-grow-1">
            <!-- Column: Tickets Abertos -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-exclamation-circle text-danger me-2"></i>Abertos
                        </h6>
                        <span class="badge bg-danger bg-opacity-25 text-danger">8</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3 mb-2"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-danger text-white" style="font-size: 0.65rem;">Urgente</span>
                            <small class="text-white-50">Há 30min</small>
                        </div>
                        <h6 class="text-white mb-1">Mariana Costa</h6>
                        <p class="text-white-50 small mb-0">Erro no login do sistema...</p>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-white-50">Há 1h</small>
                            <i class="bi bi-whatsapp text-success"></i>
                        </div>
                        <h6 class="text-white mb-1">João Pedro</h6>
                        <p class="text-white-50 small mb-0">Como alterar a senha?</p>
                    </div>
                </div>
            </div>

            <!-- Column: Em Análise -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-tools text-info me-2"></i>Em Análise
                        </h6>
                        <span class="badge bg-info bg-opacity-25 text-info">3</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3 mb-2"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-info text-dark" style="font-size: 0.65rem;">Técnico</span>
                            <small class="text-white-50">Há 4h</small>
                        </div>
                        <h6 class="text-white mb-1">Clinica Saúde</h6>
                        <p class="text-white-50 small mb-0">Integração com API falhando...</p>
                    </div>
                </div>
            </div>

            <!-- Column: Resolvido -->
            <div class="col-md-4">
                <div class="p-3 rounded-4 h-100"
                    style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-white fw-bold mb-0">
                            <i class="bi bi-check2-circle text-success me-2"></i>Resolvido
                        </h6>
                        <span class="badge bg-success bg-opacity-25 text-success">45</span>
                    </div>

                    <!-- Card Item -->
                    <div class="p-3 rounded-3"
                        style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); opacity: 0.7;">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-success" style="font-size: 0.65rem;">Fechado</span>
                            <small class="text-white-50">Hoje</small>
                        </div>
                        <h6 class="text-white mb-1">Fernanda Lima</h6>
                        <p class="text-white-50 small mb-0">Dúvida esclarecida</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    let agentes = [];
    let agentesPorTipo = {};

    // Carrega agentes ao iniciar
    document.addEventListener('DOMContentLoaded', function () {
        carregarAgentes();
    });

    async function carregarAgentes() {
        try {
            const data = await apiCall('/api/admin/agentes');
            agentes = data.agentes || [];

            // Organiza por tipo para acesso rapido
            agentesPorTipo = {};
            agentes.forEach(a => {
                agentesPorTipo[a.tipo] = a;
            });

            atualizarUI();
        } catch (error) {
            console.error('Erro ao carregar agentes:', error);
            showToast('Erro ao carregar agentes: ' + error.message, 'danger');
        }
    }

    function atualizarUI() {
        // Atualiza switches e badges de status
        ['supervisor', 'vendas', 'suporte', 'agendamento'].forEach(tipo => {
            const agente = agentesPorTipo[tipo];
            if (agente) {
                // Atualiza switch se existir
                const switchEl = document.querySelector(`input[onchange="toggleAgente('${tipo}')"]`);
                if (switchEl) {
                    switchEl.checked = agente.ativo;
                }

                // Atualiza badges de status
                const cardClass = `.card-${tipo}`;
                const card = document.querySelector(cardClass);
                if (card) {
                    const statusBadge = card.querySelector('.status-badge');
                    if (statusBadge) {
                        const dot = statusBadge.querySelector('.status-dot');
                        if (agente.ativo) {
                            statusBadge.innerHTML = `<span class="status-dot" style="color: ${getCorTipo(tipo)}; width: 6px; height: 6px;"></span>Online`;
                        } else {
                            statusBadge.innerHTML = `<span class="status-dot" style="color: #666; width: 6px; height: 6px;"></span>Offline`;
                        }
                    }
                }
            }
        });
    }

    function getCorTipo(tipo) {
        const cores = {
            'supervisor': '#bd34fe',
            'vendas': '#22c55e',
            'suporte': '#3b82f6',
            'agendamento': '#06b6d4'
        };
        return cores[tipo] || '#fff';
    }

    async function toggleAgente(tipo) {
        const agente = agentesPorTipo[tipo];
        if (!agente) {
            showToast('Agente nao encontrado', 'danger');
            return;
        }

        try {
            const result = await apiCall(`/api/admin/agentes/${agente.id}/toggle`, 'POST');
            agente.ativo = result.ativo;
            showToast(result.message);
            atualizarUI();
        } catch (error) {
            showToast('Erro: ' + error.message, 'danger');
            // Reverte o switch
            const switchEl = document.querySelector(`input[onchange="toggleAgente('${tipo}')"]`);
            if (switchEl) switchEl.checked = agente.ativo;
        }
    }

    function configurarSupervisor() {
        configurarAgente('supervisor');
    }

    async function configurarAgente(tipo) {
        const agente = agentesPorTipo[tipo];
        if (!agente) {
            showToast('Agente nao encontrado. Carregando dados...', 'warning');
            await carregarAgentes();
            return;
        }

        // Preenche o modal
        document.getElementById('modalTitle').textContent = `Configurar ${agente.nome}`;
        document.getElementById('agenteId').value = agente.id;
        document.getElementById('agenteTipo').value = agente.tipo;
        document.getElementById('agenteNome').value = agente.nome;
        document.getElementById('agenteDescricao').value = agente.descricao || '';
        document.getElementById('agentePrompt').value = agente.prompt_sistema || '';
        document.getElementById('agenteAtivo').checked = agente.ativo;

        // Seleciona tools
        const toolsSelect = document.getElementById('agenteTools');
        Array.from(toolsSelect.options).forEach(opt => {
            opt.selected = (agente.tools || []).includes(opt.value);
        });

        // Seleciona categorias RAG
        const catSelect = document.getElementById('agenteCategoriasRag');
        Array.from(catSelect.options).forEach(opt => {
            opt.selected = (agente.categorias_rag || []).includes(opt.value);
        });

        const modal = new bootstrap.Modal(document.getElementById('configModal'));
        modal.show();
    }

    async function salvarAgente() {
        const id = document.getElementById('agenteId').value;
        const tipo = document.getElementById('agenteTipo').value;
        const nome = document.getElementById('agenteNome').value;
        const descricao = document.getElementById('agenteDescricao').value;
        const promptSistema = document.getElementById('agentePrompt').value;
        const ativo = document.getElementById('agenteAtivo').checked;

        // Coleta tools selecionadas
        const toolsSelect = document.getElementById('agenteTools');
        const tools = Array.from(toolsSelect.selectedOptions).map(opt => opt.value);

        // Coleta categorias RAG selecionadas
        const catSelect = document.getElementById('agenteCategoriasRag');
        const categoriasRag = Array.from(catSelect.selectedOptions).map(opt => opt.value);

        if (!nome || !promptSistema) {
            showToast('Preencha o nome e o prompt do agente', 'warning');
            return;
        }

        try {
            await apiCall(`/api/admin/agentes/${id}`, 'PUT', {
                nome: nome,
                descricao: descricao || null,
                prompt_sistema: promptSistema,
                ativo: ativo,
                tools: tools,
                categorias_rag: categoriasRag
            });

            showToast('Agente atualizado com sucesso!');
            bootstrap.Modal.getInstance(document.getElementById('configModal')).hide();
            carregarAgentes();
        } catch (error) {
            showToast('Erro: ' + error.message, 'danger');
        }
    }

    function verLogs() {
        showToast('Funcionalidade de logs em desenvolvimento', 'info');
    }

    function abrirModalNovoAgente() {
        // Limpa o modal para novo agente
        document.getElementById('modalTitle').textContent = 'Novo Agente';
        document.getElementById('formAgente').reset();
        document.getElementById('agenteId').value = '';
        document.getElementById('agenteTipo').value = '';
        document.getElementById('agenteAtivo').checked = true;

        const modal = new bootstrap.Modal(document.getElementById('configModal'));
        modal.show();
    }

    // ================= PROFISSIONAIS =================
    let profissionaisMulti = [];
    const BUSINESS_TYPE = 'infoprodutor';  // Tipo de negócio para esta tela

    // Carrega profissionais ao iniciar
    document.addEventListener('DOMContentLoaded', function () {
        carregarProfissionaisMulti();
    });

    async function carregarProfissionaisMulti() {
        try {
            // Filtra por business_type=infoprodutor
            const data = await apiCall(`/api/admin/profissionais?apenas_ativos=false&business_type=${BUSINESS_TYPE}`);
            profissionaisMulti = data.profissionais || [];
            renderizarProfissionaisCards();
        } catch (error) {
            console.error('Erro ao carregar profissionais:', error);
            document.getElementById('listaProfissionaisCards').innerHTML = `
                <div class="col-12 text-center text-white-50 py-4">
                    <i class="bi bi-exclamation-circle"></i> Erro ao carregar profissionais
                </div>
            `;
        }
    }

    function renderizarProfissionaisCards() {
        const container = document.getElementById('listaProfissionaisCards');

        if (profissionaisMulti.length === 0) {
            container.innerHTML = `
                <div class="col-12 text-center text-white-50 py-4">
                    <i class="bi bi-person-plus"></i> Nenhum profissional cadastrado<br>
                    <small>Clique em "Novo Profissional" para adicionar</small>
                </div>
            `;
            return;
        }

        container.innerHTML = profissionaisMulti.map(p => `
            <div class="col-md-4 col-lg-3">
                <div class="p-3 rounded-4 h-100 ${!p.ativo ? 'opacity-50' : ''}"
                    style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.2s; cursor: pointer;"
                    onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.borderColor='rgba(6, 182, 212, 0.5)';"
                    onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.1)';"
                    onclick="editarProfissionalMulti(${p.id})">
                    <div class="d-flex align-items-center gap-3">
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 50px; height: 50px; min-width: 50px; background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(6, 182, 212, 0.05)); border: 1px solid rgba(6, 182, 212, 0.3);">
                            <i class="bi bi-person text-white" style="font-size: 1.3rem;"></i>
                        </div>
                        <div class="flex-grow-1 overflow-hidden">
                            <h6 class="text-white mb-1 text-truncate fw-bold">${p.nome}</h6>
                            <small class="text-white-50">${p.cargo || p.especialidade || 'Profissional'}</small>
                            <div class="mt-1">
                                <span class="badge ${p.ativo ? 'bg-success' : 'bg-secondary'}" style="font-size: 0.65rem;">
                                    ${p.ativo ? 'Ativo' : 'Inativo'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function abrirModalNovoProfissional() {
        document.getElementById('modalProfMultiTitle').textContent = 'Novo Profissional';
        document.getElementById('formProfissionalMulti').reset();
        document.getElementById('profMultiId').value = '';
        document.getElementById('btnDesativarMulti').classList.add('d-none');
        new bootstrap.Modal(document.getElementById('modalProfissionalMulti')).show();
    }

    function editarProfissionalMulti(id) {
        const prof = profissionaisMulti.find(p => p.id === id);
        if (!prof) return;

        document.getElementById('modalProfMultiTitle').textContent = 'Editar Profissional';
        document.getElementById('profMultiId').value = prof.id;
        document.getElementById('profMultiNome').value = prof.nome;
        document.getElementById('profMultiCargo').value = prof.cargo || '';
        document.getElementById('profMultiEspecialidade').value = prof.especialidade || '';
        document.getElementById('btnDesativarMulti').classList.toggle('d-none', !prof.ativo);

        new bootstrap.Modal(document.getElementById('modalProfissionalMulti')).show();
    }

    async function salvarProfissionalMulti() {
        const id = document.getElementById('profMultiId').value;
        const data = {
            nome: document.getElementById('profMultiNome').value,
            cargo: document.getElementById('profMultiCargo').value || null,
            especialidade: document.getElementById('profMultiEspecialidade').value || null,
            business_type: BUSINESS_TYPE  // Sempre cria como infoprodutor
        };

        if (!data.nome) {
            showToast('O nome é obrigatório', 'warning');
            return;
        }

        try {
            if (id) {
                await apiCall(`/api/admin/profissionais/${id}`, 'PUT', data);
                showToast('Profissional atualizado com sucesso!');
            } else {
                await apiCall('/api/admin/profissionais', 'POST', data);
                showToast('Profissional criado com sucesso!');
            }

            bootstrap.Modal.getInstance(document.getElementById('modalProfissionalMulti')).hide();
            carregarProfissionaisMulti();
        } catch (error) {
            showToast('Erro: ' + error.message, 'danger');
        }
    }

    async function desativarProfissionalMulti() {
        const id = document.getElementById('profMultiId').value;
        if (!id) return;
        if (!confirm('Tem certeza que deseja desativar este profissional? Ele não aparecerá mais para agendamentos.')) return;

        try {
            await apiCall(`/api/admin/profissionais/${id}`, 'DELETE');
            showToast('Profissional desativado!');
            bootstrap.Modal.getInstance(document.getElementById('modalProfissionalMulti')).hide();
            carregarProfissionaisMulti();
        } catch (error) {
            showToast('Erro: ' + error.message, 'danger');
        }
    }
    // ================= KNOWLEDGE BASE =================
    let kbModal = null;
    let docEditorModal = null;
    let currentDocId = null;
    let kbDocuments = [];

    function abrirModalKnowledgeBase() {
        if (!kbModal) {
            kbModal = new bootstrap.Modal(document.getElementById('modalKnowledgeBase'));
        }
        kbModal.show();
        carregarDocumentosKB();
    }

    function novoDocumentoKB() {
        currentDocId = null;
        document.getElementById('formDocumentoKB').reset();
        document.getElementById('docId').value = '';
        document.getElementById('modalDocTitle').innerText = 'Novo Documento';
        document.getElementById('btnExcluirDoc').classList.add('d-none');

        if (!docEditorModal) {
            docEditorModal = new bootstrap.Modal(document.getElementById('modalDocumentoEditor'));
        }
        docEditorModal.show();
    }

    async function editarDocumentoKB(id) {
        currentDocId = id;
        const doc = kbDocuments.find(d => d.id === id);
        if (!doc) return;

        document.getElementById('docId').value = doc.id;
        document.getElementById('docTitulo').value = doc.titulo;
        document.getElementById('docCategoria').value = doc.categoria;
        document.getElementById('docConteudo').value = doc.conteudo;

        document.getElementById('modalDocTitle').innerText = 'Editar Documento';
        document.getElementById('btnExcluirDoc').classList.remove('d-none');

        if (!docEditorModal) {
            docEditorModal = new bootstrap.Modal(document.getElementById('modalDocumentoEditor'));
        }
        docEditorModal.show();
    }

    async function carregarDocumentosKB() {
        const loading = document.getElementById('kbLoading');
        const empty = document.getElementById('kbEmpty');
        const list = document.getElementById('kbList');

        loading.classList.remove('d-none');
        empty.classList.add('d-none');
        list.classList.add('d-none');

        try {
            const response = await fetch('/api/documentos');
            const data = await response.json();
            kbDocuments = data.documentos || [];

            loading.classList.add('d-none');

            if (kbDocuments.length === 0) {
                empty.classList.remove('d-none');
                return;
            }

            list.innerHTML = kbDocuments.map(doc => `
                <div class="list-group-item list-group-item-action bg-transparent border-secondary text-white d-flex justify-content-between align-items-center px-3 py-3">
                    <div class="d-flex align-items-center gap-3 overflow-hidden">
                        <div class="rounded-circle bg-dark d-flex align-items-center justify-content-center flex-shrink-0" 
                             style="width: 40px; height: 40px; border: 1px solid rgba(255,255,255,0.1);">
                            <i class="bi bi-file-text text-white-50"></i>
                        </div>
                        <div class="overflow-hidden">
                            <h6 class="mb-0 text-truncate">${doc.titulo}</h6>
                            <div class="d-flex gap-2 align-items-center mt-1">
                                <span class="badge bg-secondary bg-opacity-25 text-secondary border border-secondary border-opacity-25" 
                                      style="font-size: 0.7rem;">${doc.categoria}</span>
                                <small class="text-white-50" style="font-size: 0.75rem;">
                                    ${new Date(doc.created_at).toLocaleDateString('pt-BR')}
                                </small>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-icon btn-sm text-white-50 hover-white" 
                            onclick="editarDocumentoKB(${doc.id})">
                        <i class="bi bi-pencil"></i>
                    </button>
                </div>
            `).join('');

            list.classList.remove('d-none');

        } catch (error) {
            console.error(error);
            loading.classList.add('d-none');
            showToast('Erro ao carregar documentos', 'error');
        }
    }

    async function salvarDocumentoKB() {
        const id = document.getElementById('docId').value;
        const titulo = document.getElementById('docTitulo').value;
        const categoria = document.getElementById('docCategoria').value;
        const conteudo = document.getElementById('docConteudo').value;

        if (!titulo || !categoria || !conteudo) {
            showToast('Preencha todos os campos obrigatórios', 'warning');
            return;
        }

        try {
            const method = id ? 'PUT' : 'POST';
            const url = id ? `/api/documentos/${id}` : '/api/documentos';

            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ titulo, categoria, conteudo })
            });

            if (response.ok) {
                showToast('Documento salvo com sucesso!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('modalDocumentoEditor')).hide();
                carregarDocumentosKB(); // Refresh list
            } else {
                throw new Error('Falha ao salvar');
            }
        } catch (error) {
            console.error(error);
            showToast('Erro ao salvar documento', 'error');
        }
    }

    async function excluirDocumentoKB() {
        if (!currentDocId) return;
        if (!confirm('Tem certeza que deseja excluir este documento?')) return;

        try {
            const response = await fetch(`/api/documentos/${currentDocId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                showToast('Documento excluído!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('modalDocumentoEditor')).hide();
                carregarDocumentosKB(); // Refresh list
            } else {
                throw new Error('Falha ao excluir');
            }
        } catch (error) {
            console.error(error);
            showToast('Erro ao excluir documento', 'error');
        }
    }
</script>
{% endblock %}